# 结构和层叠

## 特殊性

选择器的特殊性由选择器本身的组件确定。特殊性值表述为 4 个部分，如 0，0，0，0。一个选择器的具体特殊性如下确定：

- 对于选择器中给定的各个 ID 属性值，加 0，1，0，0
- 对于选择器中给定的各个类属性值、属性选择或伪类，加 0，0，1，0
- 对于选择器中给定的各个元素和伪元素，加 0，0，0，1
- 结合符和通配选择符对特殊性没有任何贡献

其他一些需要注意的点：

- 特殊性值 0，0，1，0 比 0，0，0，13 更高，之所以会这样，是因为值都是从左向右排序的，特殊性值 1，0，0，0 大于以 0 开头的所有特殊性值，而不论后面的数是什么
- 特殊性值中第一个 0 是为內联样式声明保留的，它比所有其他声明的特殊性都高
- 标志为 `!important` 的声明并没有特殊的特殊性值，但是能超过其它声明的特殊性（事实上，会将标志为 `!important` 的声明归为一组，然后再看特殊性值）

## 继承

- **继承的值根本没有特殊性**，甚至连 0 特殊性也没有
- 尽量避免使用通配符选择器，避免一些不必要的问题

关于第一点，看个例子：

```html
<style>
  p {
    color: red !important;
  }

  span {
    color: blue;
  }
</style>
<body>
  <p><span>test</span></p>
</body>
```

很显然，span 标签內的文字是蓝色的，因为继承的值没有特殊性。

## 层叠

层叠规则：

1. 找出所有相关的规则，这些规则都包含一个与给定元素匹配的选择器
2. 按显式权重对应用到该元素的所有声明排序。标志  `!important` 的规则的权重要高于没有 `!important` 标志的规则。按来源对应用到给定元素的所有声明排序。共有三种来源：创作人员、读者和用户代理。正常情况下，创作人员的样式要胜过读者的样式。有 `!important` 标志的读者样式要强于所有其它样式，这包括有 `!important` 标志的创作人员样式。创作人员样式和读者样式都比用户代理的默认样式要强
3. 按特殊性对应用到给定元素的所有声明排序
4. 按出现顺序对应用到给定元素的所有声明排序。一个声明在样式表或文档中越后出现，它的权重越大。**如果样式表中有导入的样式表，一般认为出现在导入样式表中的声明在前，主样式表中的所有声明在后**。

在声明权重方面要考虑 5 级，权重由大到小的顺序依次为：

1. 读者的重要声明（`!important`）
2. 创作人员的重要声明
3. 创作人员的正常声明
4. 读者的正常声明
5. 用户代理声明

